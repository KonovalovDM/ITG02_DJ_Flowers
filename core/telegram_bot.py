"""
telegram_bot.py ‚Äì –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–∫–∞–∑–∞—Ö —á–µ—Ä–µ–∑ Telegram.
"""

from aiogram import Bot
from django.conf import settings
from core.models import Order
from asgiref.sync import sync_to_async

bot = Bot(token=settings.TELEGRAM_BOT_TOKEN)

async def notify_admin(order_id):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ.
    """
    try:
        # –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        order = await sync_to_async(Order.objects.get, thread_sensitive=True)(id=order_id)
        message = (
            f"üõí –ù–æ–≤—ã–π –∑–∞–∫–∞–∑!\n"
            f"üìå ID: {order.id}\n"
            f"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {order.user.username}\n"
            f"üì¶ –¢–æ–≤–∞—Ä—ã: {order.products.all()}\n"
            f"üìÖ –î–∞—Ç–∞: {order.order_date.strftime('%d.%m.%Y %H:%M')}\n"
            f"üìå –°—Ç–∞—Ç—É—Å: {order.get_status_display()}"
        )
        await bot.send_message(chat_id=settings.TELEGRAM_ADMIN_ID, text=message)
    except Order.DoesNotExist:
        print(f"–û—à–∏–±–∫–∞: –∑–∞–∫–∞–∑ {order_id} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
